<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>浅析Objective-C字面量 | Duke&#39;s blog</title>
  <meta name="author" content="Duke">

  
  <meta name="description" content="编写Objective-C程序时，总会用到某几个类，它们属于Foundation框架。虽然从技术上来说，不用Foundation框架也能写出Objective-C代码，但实际上却经常要用到此框架。这几个类是NSString、NSNumber、NSArray、NSDictionary。从类名上即可看出各自所表示的数据结构。">
  
  

  <link rel="alternate" href="/atom.xml" title="Duke&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><nav>
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about/index.html">About</a></li>
    
  </ul>
</nav></header>
  <div id="content" class="inner"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <header>
    
  
    <h1 class="title">浅析Objective-C字面量</h1>
  

    <time datetime="2015-04-07T00:00:00.000Z">
  <span class="day">7</span><span class="month">Apr</span>
</time>
  </header>
  <div class="entry-content">
    
      <p>编写Objective-C程序时，总会用到某几个类，它们属于Foundation框架。虽然从技术上来说，不用Foundation框架也能写出Objective-C代码，但实际上却经常要用到此框架。这几个类是NSString、NSNumber、NSArray、NSDictionary。从类名上即可看出各自所表示的数据结构。<br><a id="more"></a></p>
<p>Objective-C以语法繁杂而著称。事实上的确是这样。不过，从Objective-C 1.0起，有一种非常简单的方式能创建NSString对象。这就是“字符串字面量”（string literal），其语法如下：<br>NSString *someString = @”Effective Objective-C 2.0”;</p>
<p>如果不用这种语法的话，就要以常见的alloc及init方法来分配并初始化NSString对象了。在版本较新的编译器中，也能用这种字面量语法来声明NSNumber、NSArray、NSDictionary类的实例。使用字面量语法（literal syntax）可以缩减源代码长度，使其更为易读。</p>
<p>字面数值</p>
<p>有时需要把整数、浮点数、布尔值封入Objective-C对象中。这种情况下可以用NSNumber类，该类可处理多种类型的数值。若是不用字面量，那么就需要按下述方式创建实例：<br>NSNumber *someNumber = [NSNumber numberWithInt:1];</p>
<p>上面这行代码创建了一个数字，将其值设为整数1。然而使用字面量能令代码更为整洁：<br>NSNumber *someNumber = @1;</p>
<p>大家可以看到，字面量语法更为精简。不过它还有很多好处。能够以NSNumber实例表示的所有数据类型都可使用该语法。例如：<br>NSNumber <em>intNumber = @1;<br>NSNumber </em>floatNumber = @2.5f;<br>NSNumber <em>doubleNumber = @3.14159;<br>NSNumber </em>boolNumber = @YES;<br>NSNumber *charNumber = @’a’;</p>
<p>字面量语法也适用于下述表达式：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">float</span> y = <span class="number">6.32</span>f;</span><br><span class="line"><span class="built_in">NSNumber</span> *expressionNumber = @(x * y);</span><br></pre></td></tr></table></figure></p>
<p>以字面量来表示数值十分有用。这样做可以令NSNumber对象变得整洁，因为声明中只包含数值，而没有多余的语法成分。</p>
<p>字面量数组</p>
<p>数组是常用的数据结构。如果不使用字面量语法，那么就要这样来创建数组：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *animals =</span><br><span class="line">    [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"cat"</span>, <span class="string">@"dog"</span>,</span><br><span class="line">                             <span class="string">@"mouse"</span>, <span class="string">@"badger"</span>, <span class="literal">nil</span>];</span><br></pre></td></tr></table></figure></p>
<p>而使用字面量语法来创建则是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *animals = @[<span class="string">@"cat"</span>, <span class="string">@"dog"</span>, <span class="string">@"mouse"</span>, <span class="string">@"badger"</span>];</span><br></pre></td></tr></table></figure></p>
<p>上面这种做法不仅简单，而且还利于操作数组。数组的常见操作就是取某个下标所对应的对象，这用字面量来做更为容易。如果不用字面量，那么通常会用“objectAtIndex:”方法：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *dog = [animals objectAtIndex:<span class="number">1</span>];</span><br></pre></td></tr></table></figure></p>
<p>若使用字面量，则是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *dog = animals[<span class="number">1</span>];</span><br></pre></td></tr></table></figure></p>
<p>这也叫做“取下标”操作（subscripting），与使用字面量语法的其他情况一样，这种方式也更为简洁、更易理解，而且与其他语言中依下标来访问数组元素时所用的语法类似。</p>
<p>不过，用字面量语法创建数组时要注意，若数组元素对象中有nil，则会抛出异常，因为字面量语法实际上只是一种“语法糖”（syntactic sugar），其效果等于是先创建了一个数组，然后把方括号内的所有对象都加到这个数组中。抛出的异常会是这样：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*** Terminating app due to uncaught exception</span><br><span class="line">'NSInvalidArgumentException', reason: '***</span><br><span class="line">-[__NSPlaceholderArray initWithObjects:count:]: attempt to</span><br><span class="line">insert nil object from objects[0]'</span><br></pre></td></tr></table></figure></p>
<p>在改用字面量语法来创建数组时就会遇到这个问题。下面这段代码分别以两种语法创建数组：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> object1 = <span class="comment">/* ... */</span>;</span><br><span class="line"><span class="keyword">id</span> object2 = <span class="comment">/* ... */</span>;</span><br><span class="line"><span class="keyword">id</span> object3 = <span class="comment">/* ... */</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSArray</span> *arrayA = [<span class="built_in">NSArray</span> array WithObjects:</span><br><span class="line">                       object1, object2, object3, <span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *arrayB = @[object1, object2, object3];</span><br></pre></td></tr></table></figure></p>
<p>大家想想：如果object1与object3都指向了有效的Objective-C对象，而object2是nil，那么会出现什么情况呢？按字面量语法创建数组arrayB时会抛出异常。arrayA虽然能创建出来，但是其中却只含有object1一个对象。原因在于，“arrayWithObjects:”方法会依次处理各个参数，直到发现nil为止，由于object2是nil，所以该方法会提前结束。</p>
<p>这个微妙的差别表明，使用字面量语法更为安全。抛出异常令应用程序终止执行，这比创建好数组之后才发现元素个数少了要好。向数组中插入nil通常说明程序有错，而通过异常可以更快地发现这个错误。</p>
<p>字面量字典</p>
<p>“字典”（Dictionary）是一种映射型数据结构，可向其中添加键值对。与数组一样，Objective-C代码也经常用到字典。其创建方式如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDictionary</span> *personData =</span><br><span class="line">    [NSDictionarydictionaryWithObjectsAndKeys:</span><br><span class="line">        <span class="string">@"Matt"</span>, <span class="string">@"firstName"</span>,</span><br><span class="line">        <span class="string">@"Galloway"</span>, <span class="string">@"lastName"</span>,</span><br><span class="line">        [<span class="built_in">NSNumber</span> numberWithInt:<span class="number">28</span>], <span class="string">@"age"</span>,</span><br><span class="line">        <span class="literal">nil</span>];</span><br></pre></td></tr></table></figure></p>
<p>这样写令人困惑，因为其顺序是&lt;对象&gt;，&lt;键&gt;，&lt;对象&gt;，&lt;键&gt;。这与通常理解的顺序相反，我们一般认为是把“键”映射到“对象”。因此，这种写法不容易读懂。如果改用字面量语法，就清晰多了：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSDictionary</span> *personData =</span><br><span class="line">    @&#123;<span class="string">@"firstName"</span> : <span class="string">@"Matt"</span>,</span><br><span class="line">      <span class="string">@"lastName"</span> : <span class="string">@"Galloway"</span>,</span><br><span class="line">      <span class="string">@"age"</span> : @<span class="number">28</span>&#125;;</span><br></pre></td></tr></table></figure></p>
<p>上面这种写法更简明，而且键出现在对象之前，理解起来较顺畅。此范例代码还说明了使用字面量数值的好处。字典中的对象和键必须都是Objective-C对象，所以不能把整数28直接放进去，而要将其封装在NSNumber实例中才行。使用字面量语法很容易就能做到这一点，只需给数字前加一个@字符即可。</p>
<p>与数组一样，用字面量语法创建字典时也有个问题，那就是一旦有值为nil，便会抛出异常。不过基于同样的原因，这也是个好事。假如在创建字典时不小心用了空值对象，那么“dictionaryWithObjectsAndKeys:”方法就会在首个nil之前停下，并抛出异常，这有助于查错。</p>
<p>字典也可以像数组那样用字面量语法访问。按照特定键访问其值的传统做法是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *lastName = [personData objectForKey:<span class="string">@"lastName"</span>];</span><br></pre></td></tr></table></figure></p>
<p>与之等效的字面量语法则是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *lastName = personData[<span class="string">@"lastName"</span>];</span><br></pre></td></tr></table></figure></p>
<p>这样写也省去了冗赘的语法，令此行代码简单易读。</p>
<p>可变数组与字典</p>
<p>通过取下标操作，可以访问数组中某个下标或字典中某个键所对应的元素。如果数组与字典对象是可变的（mutable），那么也能通过下标修改其中的元素值。修改可变数组与字典内容的标准做法是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mutableArray replaceObjectAtIndex:<span class="number">1</span> withObject:<span class="string">@"dog"</span>];</span><br><span class="line">[mutableDictionary setObject:<span class="string">@"Galloway"</span>forKey:<span class="string">@"lastName"</span>];</span><br></pre></td></tr></table></figure></p>
<p>若换用取下标操作来写，则是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mutableArray[<span class="number">1</span>] = <span class="string">@"dog"</span>;</span><br><span class="line">mutableDictionary[<span class="string">@"lastName"</span>] = <span class="string">@"Galloway"</span>;</span><br></pre></td></tr></table></figure></p>
<p>局限性</p>
<p>字面量语法有个小小的限制，就是除了字符串以外，所创建出来的对象必须属于Foundation框架才行。如果自定义了这些类的子类，则无法用字面量语法创建其对象。要想创建自定义子类的实例，必须采用“非字面量语法”（nonliteral syntax）。然而，由于NSArray、NSDictionary、NSNumber都是业已定型的“子族”（class cluster，参见第9条），因此很少有人会从其中自定义子类，真要那样做也比较麻烦。而且一般来说，标准的实现已经很好了，无须再改动。创建字符串时可以使用自定义的子类，然而必须要修改编译器的选项才行。除非你明白这样做的后果，否则不鼓励使用此选项，用NSString就足够了。</p>
<p>使用字面量语法创建出来的字符串、数组、字典对象都是不可变的（immutable）。若想要可变版本的对象，则需复制一份：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableArray</span> *<span class="keyword">mutable</span> = [@[@<span class="number">1</span>, @<span class="number">2</span>, @<span class="number">3</span>, @<span class="number">4</span>, @<span class="number">5</span>]mutableCopy];</span><br></pre></td></tr></table></figure></p>
<p>这么做会多调用一个方法，而且还要再创建一个对象，不过使用字面量语法所带来的好处还是多于上述缺点的。</p>
<p>要点</p>
<p>应该使用字面量语法来创建字符串、数值、数组、字典。与创建此类对象的常规方法相比，这么做更加简明扼要。</p>
<p>应该通过取下标操作来访问数组下标或字典中的键所对应的元素。</p>
<p>用字面量语法创建数组或字典时，若值中有nil，则会抛出异常。因此，务必确保值里不含nil。</p>

    
    
    <footer class="meta">
      
      
  <div class="tags">
<a href="/tags/iOS开发/">iOS开发</a></div>

      
    </footer>
    
  </div>
  
</article></div>
  <footer id="footer" class="inner"><div class="social alignright">
  
  
  
  
    <a class="github" href="https://github.com/https://github.com/leodouglasduke" title="GitHub">GitHub</a>
  
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>
  
  &copy; 2015 Duke
  
</p>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="phasebeam">
  <canvas></canvas>
  <canvas></canvas>
  <canvas></canvas>
</div>
<script src="/js/phasebeam.js"></script>
</body>
</html>